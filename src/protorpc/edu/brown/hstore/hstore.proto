import "ca/evanjones/protorpc/Protocol.proto";

package edu.brown.hstore;

// -----------------------------------
// MESSAGES
// -----------------------------------

message StatusRequest {
    required int32 sender_partition_id = 1;
    required int32 dest_partition_id = 2;
}

message StatusAcknowledgement {
    required int32 sender_partition_id = 1;
    required int32 dest_partition_id = 2;
    required string message = 3;
}

message FragmentDependency {
	required int32 dependency_id = 1;
    required bytes data = 2;
}

message FragmentTransfer {
    required int32 sender_partition_id = 1;
    required int32 dest_partition_id = 2;
    required int64 txn_id = 3;
    repeated FragmentDependency dependencies = 4;
}

message FragmentAcknowledgement {
    required int32 sender_partition_id = 1;
    required int32 dest_partition_id = 2;
    required int64 txn_id = 3;
}

// -----------------------------------
// SERVICE
// -----------------------------------

service HStoreService {
   rpc GetStatus (StatusRequest) returns (StatusAcknowledgement);
   rpc SendFragment (FragmentTransfer) returns (FragmentAcknowledgement);
}